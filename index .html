<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸš€  AIR COMBAT </title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%23000' width='100' height='100'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%2300ff00' font-family='monospace' font-size='40'%3E%26%23x3C%3B/%3E%3C/text%3E%3C/svg%3E" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: white;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .game-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #1e90ff, #87CEEB);
        }

        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .header {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid #FFD700;
        }

        .game-title {
            font-size: 20px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 0 #000;
        }

        .stats {
            display: flex;
            gap: 25px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 22px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 0 #000;
        }

        .stat-label {
            font-size: 11px;
            color: #ccc;
            text-shadow: 1px 1px 0 #000;
        }

        .joystick-area {
            position: absolute;
            bottom: 100px;
            left: 30px;
            width: 120px;
            height: 120px;
            pointer-events: all;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 50%;
            border: 2px solid #FFD700;
        }

        .joystick {
            width: 50px;
            height: 50px;
            background: rgba(255, 215, 0, 0.9);
            border-radius: 50%;
            position: absolute;
            top: 35px;
            left: 35px;
            cursor: move;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .fire-btn {
            position: absolute;
            bottom: 110px;
            right: 30px;
            width: 70px;
            height: 70px;
            background: rgba(255, 50, 50, 0.9);
            border: 2px solid #FF0000;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            pointer-events: all;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
            text-shadow: 1px 1px 0 #000;
        }

        .fire-btn:active {
            background: rgba(255, 0, 0, 1);
            transform: scale(0.95);
        }

        .controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .control-btn {
            background: rgba(255, 215, 0, 0.9);
            border: 2px solid #000;
            color: #000;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            pointer-events: all;
            border-radius: 20px;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
            box-shadow: 3px 3px 0 #000;
        }

        .control-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 #000;
        }

        .game-menu {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 4px solid #FFD700;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            z-index: 20;
            pointer-events: all;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            min-width: 350px;
            image-rendering: auto;
        }

        .menu-title {
            font-size: 32px;
            margin-bottom: 15px;
            color: #FFD700;
            text-shadow: 3px 3px 0 #000;
        }

        .menu-subtitle {
            font-size: 16px;
            margin-bottom: 25px;
            color: #ccc;
            text-shadow: 1px 1px 0 #000;
        }

        .menu-btn {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border: 2px solid #000;
            color: #000;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 8px;
            width: 200px;
            border-radius: 20px;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.5);
            box-shadow: 3px 3px 0 #000;
        }

        .menu-btn:active {
            transform: translate(2px, 2px);
            box-shadow: 1px 1px 0 #000;
        }

        .hidden {
            display: none;
        }

        .game-over {
            color: #ff4444;
        }

        .level-up {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            color: #FFD700;
            z-index: 15;
            animation: levelUp 2s ease-out;
            text-shadow: 2px 2px 0 #000;
            border: 2px solid #FFD700;
        }

        @keyframes levelUp {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        .pixel-font {
            image-rendering: pixelated;
            font-family: 'Courier New', monospace;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
            }
            
            .game-title {
                font-size: 16px;
            }
            
            .stat-value {
                font-size: 18px;
            }
            
            .stat {
                gap: 2px;
            }
            
            .game-menu {
                min-width: 90%;
                padding: 20px 15px;
            }
            
            .menu-title {
                font-size: 24px;
            }
            
            .menu-btn {
                padding: 10px 20px;
                font-size: 14px;
                width: 180px;
            }
            
            .joystick-area {
                width: 100px;
                height: 100px;
                bottom: 90px;
                left: 20px;
            }
            
            .joystick {
                width: 40px;
                height: 40px;
                top: 30px;
                left: 30px;
            }
            
            .fire-btn {
                width: 60px;
                height: 60px;
                bottom: 100px;
                right: 20px;
                font-size: 12px;
            }
        }

        /* Animation des nuages */
        @keyframes cloudMove {
            from { transform: translateX(-100px); }
            to { transform: translateX(calc(100vw + 100px)); }
        }

        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: cloudMove linear infinite;
        }

        /* Style pixel art pour les Ã©lÃ©ments */
        .pixel-border {
            border-style: solid;
            border-width: 2px;
            border-color: #000;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
        
        <div class="ui-overlay">
            <div class="header">
                <div class="game-title pixel-font">ðŸš€  AIR COMBAT</div>
                <div class="stats">
                    <div class="stat">
                        <div class="stat-value" id="score">0</div>
                        <div class="stat-label">SCORE</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="lives">3</div>
                        <div class="stat-label">VIES</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value" id="level">1</div>
                        <div class="stat-label">NIVEAU</div>
                    </div>
                </div>
            </div>
            
            <div class="joystick-area">
                <div class="joystick" id="joystick"></div>
            </div>
            
            <button class="fire-btn" id="fireBtn">TIRER</button>
            
            <div class="controls">
                <button class="control-btn pixel-font" id="pauseBtn">PAUSE</button>
                <button class="control-btn pixel-font" id="menuBtn">MENU</button>
            </div>
        </div>
        
        <div class="game-menu" id="mainMenu">
            <h1 class="menu-title pixel-font">PIXEL AIR COMBAT</h1>
            <p class="menu-subtitle pixel-font">Mission de combat aÃ©rien rÃ©tro!</p>
            <button class="menu-btn pixel-font" id="startBtn">JOUER</button>
            <button class="menu-btn pixel-font" id="leaderboardBtn">CLASSEMENT</button>
        </div>
        
        <div class="game-menu hidden" id="pauseMenu">
            <h1 class="menu-title pixel-font">PAUSE</h1>
            <button class="menu-btn pixel-font" id="resumeBtn">REPRENDRE</button>
            <button class="menu-btn pixel-font" id="mainMenuBtn">MENU</button>
        </div>
        
        <div class="game-menu hidden" id="gameOverMenu">
            <h1 class="menu-title game-over pixel-font">GAME OVER</h1>
            <p class="pixel-font">Score: <span id="finalScore">0</span></p>
            <p class="pixel-font">Niveau: <span id="finalLevel">1</span></p>
            <button class="menu-btn pixel-font" id="retryBtn">REJOUER</button>
            <button class="menu-btn pixel-font" id="mainMenuBtn2">MENU</button>
        </div>
    </div>

    <script>
        // API pour le jeu
        class GameAPI {
            constructor() {
                this.baseUrl = 'https://jsonplaceholder.typicode.com';
            }
            
            async saveScore(playerName, score, level) {
                try {
                    const response = await fetch(`${this.baseUrl}/posts`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            title: `${playerName} - Score: ${score}`,
                            body: `Level: ${level}`,
                            userId: 1,
                        }),
                    });
                    const data = await response.json();
                    console.log('Score sauvegardÃ©:', data);
                    return data;
                } catch (error) {
                    console.log('Sauvegarde locale utilisÃ©e');
                    this.saveLocal(playerName, score, level);
                    return { id: 'local', success: true };
                }
            }
            
            async getLeaderboard() {
                try {
                    const response = await fetch(`${this.baseUrl}/users`);
                    const data = await response.json();
                    return data.slice(0, 5).map((user, index) => ({
                        name: user.name,
                        score: 10000 - (index * 2000),
                        level: 5 - index
                    }));
                } catch (error) {
                    console.log('Classement local utilisÃ©');
                    return this.getLocalLeaderboard();
                }
            }
            
            saveLocal(playerName, score, level) {
                const leaderboard = JSON.parse(localStorage.getItem('pixelAirCombatLeaderboard')) || [];
                leaderboard.push({ name: playerName, score, level, date: new Date().toISOString() });
                leaderboard.sort((a, b) => b.score - a.score);
                localStorage.setItem('pixelAirCombatLeaderboard', JSON.stringify(leaderboard.slice(0, 10)));
            }
            
            getLocalLeaderboard() {
                const saved = JSON.parse(localStorage.getItem('pixelAirCombatLeaderboard')) || [];
                if (saved.length === 0) {
                    return [
                        { name: "ACE PILOT", score: 12500, level: 5 },
                        { name: "SKY WARRIOR", score: 9800, level: 4 },
                        { name: "WING COMMANDER", score: 7600, level: 3 },
                        { name: "AIR DEFENDER", score: 5400, level: 2 },
                        { name: "ROOKIE", score: 3200, level: 1 }
                    ];
                }
                return saved.slice(0, 5);
            }
        }

        // Jeu principal
        class PixelAirCombat {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.api = new GameAPI();
                
                // Configuration des pixels
                this.PIXEL_SCALE = 2;
                this.PLAYER_PIXELS = [
                    "................................",
                    "................................",
                    "...............H................",
                    "..............HHH...............",
                    ".............HHHHH..............",
                    "...............H................",
                    "...............R................",
                    "..............RRR...............",
                    "..............RRR...............",
                    ".............RRRRR..............",
                    "....RRRRRRRRRRRRRRRRRRRRRR.....",
                    "....RRRRRRRRRRRRRRRRRRRRRR.....",
                    "....RRRRRRRRRRRRRRRRRRRRRR.....",
                    ".....RRRRRRRRRRRRRRRRRRRR......",
                    "......rrrrrrrrRRRRrrrrrrrr......",
                    ".............RRRRR..............",
                    ".............RRRRR..............",
                    "..............RRR...............",
                    "...............R................",
                    "...............R................",
                    "..............RYR...............",
                    "..............RYR...............",
                    "..............RYR...............",
                    "...............R................",
                    "...............R................",
                    "..............RRR...............",
                    ".............RRRRR..............",
                    "............RRRRRRR.............",
                    "...........RRRRRRRRR............",
                    "...........RRRRRRRRR............",
                    "............RRRRRRR.............",
                    ".............RRRRR..............",
                ];
                
                this.ENEMY_PIXELS = [
                    "................................",
                    "................................",
                    "...............H................",
                    "..............HHH...............",
                    ".............HHHHH..............",
                    "...............H................",
                    "...............B................",
                    "..............BBB...............",
                    "..............BBB...............",
                    ".............BBBBB..............",
                    "....BBBBBBBBBBBBBBBBBBBBBB.....",
                    "....BBBBBBBBBBBBBBBBBBBBBB.....",
                    "....BBBBBBBBBBBBBBBBBBBBBB.....",
                    ".....BBBBBBBBBBBBBBBBBBBB......",
                    "......bbbbbbbbBBBBbbbbbbbb......",
                    ".............BBBBB..............",
                    ".............BBBBB..............",
                    "..............BBB...............",
                    "...............B................",
                    "...............B................",
                    "..............BGB...............",
                    "..............BGB...............",
                    "..............BGB...............",
                    "...............B................",
                    "...............B................",
                    "..............BBB...............",
                    ".............BBBBB..............",
                    "............BBBBBBB.............",
                    "...........BBBBBBBBB............",
                    "...........BBBBBBBBB............",
                    "............BBBBBBB.............",
                    ".............BBBBB..............",
                ];
                
                // Palette de couleurs
                this.PALETTE = {
                    ".": null, // Transparent
                    "R": "#d62828", // Rouge
                    "r": "#a61e1e", // Rouge sombre
                    "Y": "#f7c948", // Jaune cockpit
                    "H": "#3a3a3a", // HÃ©lice
                    "B": "#4a4a4a", // Bleu ennemi
                    "b": "#2a2a2a", // Bleu sombre ennemi
                    "G": "#00ff00"  // Vert cockpit ennemi
                };
                
                // Ã‰tat du jeu
                this.gameState = 'menu';
                this.score = 0;
                this.lives = 3;
                this.level = 1;
                
                // Ã‰lÃ©ments du jeu
                this.player = null;
                this.enemies = [];
                this.bullets = [];
                this.enemyBullets = [];
                this.particles = [];
                this.clouds = [];
                
                // ContrÃ´les
                this.keys = {};
                this.touch = { x: 0, y: 0, active: false };
                
                this.init();
            }
            
            init() {
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());
                
                // Ã‰vÃ©nements clavier
                document.addEventListener('keydown', (e) => {
                    this.keys[e.key] = true;
                    if (e.key === ' ' && this.gameState === 'playing') this.shoot();
                    if (e.key === 'Escape') this.togglePause();
                });
                
                document.addEventListener('keyup', (e) => {
                    this.keys[e.key] = false;
                });
                
                // Ã‰vÃ©nements tactiles
                this.setupTouchControls();
                
                // Ã‰vÃ©nements des boutons
                this.setupEventListeners();
                
                // CrÃ©er des nuages
                this.createClouds();
                
                // Boucle de jeu
                this.lastTime = 0;
                this.gameLoop(0);
            }
            
            setupTouchControls() {
                const joystick = document.getElementById('joystick');
                const joystickArea = document.querySelector('.joystick-area');
                
                joystick.addEventListener('touchstart', (e) => {
                    this.touch.active = true;
                    e.preventDefault();
                });
                
                joystickArea.addEventListener('touchmove', (e) => {
                    if (!this.touch.active) return;
                    
                    const rect = joystickArea.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - centerX;
                    const deltaY = touch.clientY - centerY;
                    
                    const distance = Math.min(Math.sqrt(deltaX * deltaX + deltaY * deltaY), 40);
                    const angle = Math.atan2(deltaY, deltaX);
                    
                    this.touch.x = Math.cos(angle) * distance / 40;
                    this.touch.y = Math.sin(angle) * distance / 40;
                    
                    joystick.style.transform = `translate(${this.touch.x * 30}px, ${this.touch.y * 30}px)`;
                    
                    e.preventDefault();
                });
                
                document.addEventListener('touchend', () => {
                    this.touch.active = false;
                    this.touch.x = 0;
                    this.touch.y = 0;
                    joystick.style.transform = 'translate(0, 0)';
                });
                
                document.getElementById('fireBtn').addEventListener('touchstart', (e) => {
                    if (this.gameState === 'playing') this.shoot();
                    e.preventDefault();
                });
            }
            
            setupEventListeners() {
                document.getElementById('startBtn').addEventListener('click', () => this.startGame());
                document.getElementById('pauseBtn').addEventListener('click', () => this.togglePause());
                document.getElementById('resumeBtn').addEventListener('click', () => this.togglePause());
                document.getElementById('retryBtn').addEventListener('click', () => this.startGame());
                document.getElementById('menuBtn').addEventListener('click', () => this.showMenu());
                document.getElementById('mainMenuBtn').addEventListener('click', () => this.showMenu());
                document.getElementById('mainMenuBtn2').addEventListener('click', () => this.showMenu());
                document.getElementById('leaderboardBtn').addEventListener('click', () => this.showLeaderboard());
            }
            
            resizeCanvas() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }
            
            createClouds() {
                this.clouds = [];
                for (let i = 0; i < 6; i++) {
                    this.clouds.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height * 0.7,
                        size: 20 + Math.random() * 30,
                        speed: 0.2 + Math.random() * 0.3
                    });
                }
            }
            
            startGame() {
                this.gameState = 'playing';
                this.score = 0;
                this.lives = 3;
                this.level = 1;
                
                this.player = {
                    x: this.canvas.width / 2 - 16 * this.PIXEL_SCALE,
                    y: this.canvas.height - 100,
                    width: 32 * this.PIXEL_SCALE,
                    height: 32 * this.PIXEL_SCALE,
                    speed: 5
                };
                
                this.enemies = [];
                this.bullets = [];
                this.enemyBullets = [];
                this.particles = [];
                
                document.getElementById('mainMenu').classList.add('hidden');
                document.getElementById('pauseMenu').classList.add('hidden');
                document.getElementById('gameOverMenu').classList.add('hidden');
                
                this.updateUI();
            }
            
            togglePause() {
                if (this.gameState === 'playing') {
                    this.gameState = 'paused';
                    document.getElementById('pauseMenu').classList.remove('hidden');
                } else if (this.gameState === 'paused') {
                    this.gameState = 'playing';
                    document.getElementById('pauseMenu').classList.add('hidden');
                }
            }
            
            showMenu() {
                this.gameState = 'menu';
                document.getElementById('mainMenu').classList.remove('hidden');
                document.getElementById('pauseMenu').classList.add('hidden');
                document.getElementById('gameOverMenu').classList.add('hidden');
            }
            
            async showLeaderboard() {
                const leaderboard = await this.api.getLeaderboard();
                alert('CLASSEMENT TOP 5:\n\n' + 
                    leaderboard.map((player, i) => 
                        `${i+1}. ${player.name} - ${player.score} pts`
                    ).join('\n')
                );
            }
            
            updateUI() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('lives').textContent = this.lives;
                document.getElementById('level').textContent = this.level;
            }
            
            shoot() {
                this.bullets.push({
                    x: this.player.x + this.player.width / 2 - 2,
                    y: this.player.y,
                    width: 4,
                    height: 10,
                    speed: 8
                });
            }
            
            gameLoop(timestamp) {
                const deltaTime = timestamp - this.lastTime;
                this.lastTime = timestamp;
                
                // Fond ciel
                this.ctx.fillStyle = '#1e90ff';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Dessiner l'arriÃ¨re-plan
                this.drawBackground();
                
                if (this.gameState === 'playing') {
                    this.updateGame(deltaTime);
                }
                
                // Dessiner les Ã©lÃ©ments du jeu
                this.drawGameElements();
                
                requestAnimationFrame((t) => this.gameLoop(t));
            }
            
            drawBackground() {
                // Nuages
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                this.clouds.forEach(cloud => {
                    this.ctx.beginPath();
                    this.ctx.arc(cloud.x, cloud.y, cloud.size, 0, Math.PI * 2);
                    this.ctx.arc(cloud.x - cloud.size * 0.3, cloud.y, cloud.size * 0.7, 0, Math.PI * 2);
                    this.ctx.arc(cloud.x + cloud.size * 0.3, cloud.y, cloud.size * 0.7, 0, Math.PI * 2);
                    this.ctx.fill();
                    
                    cloud.x += cloud.speed;
                    if (cloud.x > this.canvas.width + cloud.size) {
                        cloud.x = -cloud.size;
                        cloud.y = Math.random() * this.canvas.height * 0.7;
                    }
                });
            }
            
            updateGame(deltaTime) {
                // DÃ©placer le joueur
                this.movePlayer();
                
                // GÃ©nÃ©rer des ennemis
                this.spawnEnemies();
                
                // Mettre Ã  jour les Ã©lÃ©ments
                this.updateBullets();
                this.updateEnemies();
                this.updateParticles();
                
                // VÃ©rifier les collisions
                this.checkCollisions();
                
                // Augmenter le niveau
                if (this.score >= this.level * 1000) {
                    this.levelUp();
                }
                
                this.updateUI();
            }
            
            movePlayer() {
                let moveX = 0, moveY = 0;
                
                if (this.keys['ArrowLeft'] || this.keys['a']) moveX = -1;
                if (this.keys['ArrowRight'] || this.keys['d']) moveX = 1;
                if (this.keys['ArrowUp'] || this.keys['w']) moveY = -1;
                if (this.keys['ArrowDown'] || this.keys['s']) moveY = 1;
                
                // ContrÃ´les tactiles
                if (this.touch.active) {
                    moveX = this.touch.x;
                    moveY = this.touch.y;
                }
                
                this.player.x += moveX * this.player.speed;
                this.player.y += moveY * this.player.speed;
                
                // Limites de l'Ã©cran
                this.player.x = Math.max(0, Math.min(this.canvas.width - this.player.width, this.player.x));
                this.player.y = Math.max(0, Math.min(this.canvas.height - this.player.height, this.player.y));
            }
            
            spawnEnemies() {
                if (Math.random() < 0.02 + this.level * 0.005) {
                    this.enemies.push({
                        x: Math.random() * (this.canvas.width - 32 * this.PIXEL_SCALE),
                        y: -32 * this.PIXEL_SCALE,
                        width: 32 * this.PIXEL_SCALE,
                        height: 32 * this.PIXEL_SCALE,
                        speed: 2 + Math.random() * 1 + this.level * 0.3,
                        health: 1
                    });
                }
            }
            
            updateBullets() {
                // Balles du joueur
                for (let i = this.bullets.length - 1; i >= 0; i--) {
                    const bullet = this.bullets[i];
                    bullet.y -= bullet.speed;
                    
                    if (bullet.y < 0) {
                        this.bullets.splice(i, 1);
                    }
                }
                
                // Balles ennemies
                for (let i = this.enemyBullets.length - 1; i >= 0; i--) {
                    const bullet = this.enemyBullets[i];
                    bullet.y += bullet.speed;
                    
                    if (bullet.y > this.canvas.height) {
                        this.enemyBullets.splice(i, 1);
                    }
                }
            }
            
            updateEnemies() {
                for (let i = this.enemies.length - 1; i >= 0; i--) {
                    const enemy = this.enemies[i];
                    enemy.y += enemy.speed;
                    
                    // Tir des ennemis
                    if (Math.random() < 0.01) {
                        this.enemyBullets.push({
                            x: enemy.x + enemy.width / 2 - 2,
                            y: enemy.y + enemy.height,
                            width: 4,
                            height: 10,
                            speed: 5
                        });
                    }
                    
                    // Supprimer les ennemis hors Ã©cran
                    if (enemy.y > this.canvas.height) {
                        this.enemies.splice(i, 1);
                    }
                }
            }
            
            updateParticles() {
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const particle = this.particles[i];
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.life--;
                    
                    if (particle.life <= 0) {
                        this.particles.splice(i, 1);
                    }
                }
            }
            
            checkCollisions() {
                // Collisions balles joueur -> ennemis
                for (let i = this.bullets.length - 1; i >= 0; i--) {
                    const bullet = this.bullets[i];
                    for (let j = this.enemies.length - 1; j >= 0; j--) {
                        const enemy = this.enemies[j];
                        if (this.isColliding(bullet, enemy)) {
                            this.score += 100;
                            this.createExplosion(enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                            this.enemies.splice(j, 1);
                            this.bullets.splice(i, 1);
                            break;
                        }
                    }
                }
                
                // Collisions balles ennemies -> joueur
                for (let i = this.enemyBullets.length - 1; i >= 0; i--) {
                    const bullet = this.enemyBullets[i];
                    if (this.isColliding(bullet, this.player)) {
                        this.lives--;
                        this.createExplosion(this.player.x + this.player.width/2, this.player.y);
                        this.enemyBullets.splice(i, 1);
                        
                        if (this.lives <= 0) {
                            this.gameOver();
                        }
                    }
                }
                
                // Collisions ennemis -> joueur
                for (let i = this.enemies.length - 1; i >= 0; i--) {
                    const enemy = this.enemies[i];
                    if (this.isColliding(enemy, this.player)) {
                        this.lives--;
                        this.createExplosion(enemy.x + enemy.width/2, enemy.y + enemy.height/2);
                        this.enemies.splice(i, 1);
                        
                        if (this.lives <= 0) {
                            this.gameOver();
                        }
                    }
                }
            }
            
            isColliding(obj1, obj2) {
                return obj1.x < obj2.x + obj2.width &&
                       obj1.x + obj1.width > obj2.x &&
                       obj1.y < obj2.y + obj2.height &&
                       obj1.y + obj1.height > obj2.y;
            }
            
            createExplosion(x, y) {
                for (let i = 0; i < 10; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 6,
                        vy: (Math.random() - 0.5) * 6,
                        life: 20,
                        color: ['#FF6B6B', '#FFE66D', '#FFA500'][Math.floor(Math.random() * 3)]
                    });
                }
            }
            
            levelUp() {
                this.level++;
                this.showLevelUp();
            }
            
            showLevelUp() {
                const levelUp = document.createElement('div');
                levelUp.className = 'level-up pixel-font';
                levelUp.textContent = `NIVEAU ${this.level}!`;
                document.querySelector('.game-container').appendChild(levelUp);
                
                setTimeout(() => {
                    levelUp.remove();
                }, 2000);
            }
            
            drawGameElements() {
                // Dessiner le joueur
                if (this.player) {
                    this.drawPixelArt(this.PLAYER_PIXELS, this.player.x, this.player.y, this.PIXEL_SCALE);
                }
                
                // Dessiner les ennemis
                this.enemies.forEach(enemy => {
                    this.drawPixelArt(this.ENEMY_PIXELS, enemy.x, enemy.y, this.PIXEL_SCALE);
                });
                
                // Dessiner les balles
                this.ctx.fillStyle = '#FFE66D';
                this.bullets.forEach(bullet => {
                    this.ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                });
                
                this.ctx.fillStyle = '#FF6B6B';
                this.enemyBullets.forEach(bullet => {
                    this.ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
                });
                
                // Dessiner les particules
                this.particles.forEach(particle => {
                    this.ctx.fillStyle = particle.color;
                    this.ctx.globalAlpha = particle.life / 20;
                    this.ctx.fillRect(particle.x, particle.y, 4, 4);
                    this.ctx.globalAlpha = 1;
                });
            }
            
            drawPixelArt(pixelData, x, y, scale) {
                for (let py = 0; py < 32; py++) {
                    const row = pixelData[py] || "";
                    for (let px = 0; px < 32; px++) {
                        const color = this.PALETTE[row[px] || "."];
                        if (!color) continue;
                        this.ctx.fillStyle = color;
                        this.ctx.fillRect(x + px * scale, y + py * scale, scale, scale);
                    }
                }
            }
            
            gameOver() {
                this.gameState = 'gameOver';
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('finalLevel').textContent = this.level;
                document.getElementById('gameOverMenu').classList.remove('hidden');
                
                // Sauvegarder le score
                this.api.saveScore('PILOTE', this.score, this.level);
            }
        }

        // DÃ©marrer le jeu
        window.addEventListener('load', () => {
            new PixelAirCombat();
        });
    </script>
</body>
</html>